# プロジェクト固有ルール

## 実行フロー（必須）

このプロジェクトでは、すべてのタスクに以下のフローを適用する。

### フロー概要

```
1. [計画] Codex（Architect）が実装計画を策定
     ↓
2. [実施] Claude Code が計画に沿って実装
     ↓
3. [レビュー] Codex（Code Reviewer）が多角的に徹底レビュー
     ↓
4. [判定] APPROVE なら完了 / REJECT なら 2 に戻る
```

---

### Step 1: Codex による計画策定

**常に最初に行う。実装前に計画なし・Codex承認なしで進めてはならない。**

- Expert: **Architect**（Advisory モード / `read-only`）
- Architect プロンプトファイルを読み込み、`developer-instructions` に注入すること
- 計画には以下を含めること:
  - 変更対象ファイルの一覧
  - 各ファイルへの具体的な変更内容
  - 変更の順序と依存関係
  - 検証方法

### Step 2: Claude Code による実施

- Step 1 で策定した計画のみを実施する
- 計画にないことは自己判断で追加しない
- 実施したファイル・変更内容を記録しておく

### Step 3: Codex による徹底レビュー

**実施後は必ずレビューを行う。自己判断でスキップしてはならない。**

- Expert: **Code Reviewer**（Advisory モード / `read-only`）
- Code Reviewer プロンプトファイルを読み込み、`developer-instructions` に注入すること
- レビュー依頼には以下を必ず含めること:
  - 実施した変更の全内容（ファイルパス・差分）
  - 変更の目的・背景
  - Step 1 の計画内容

**レビューで確認する観点（漏れなく指示すること）:**
- 機能的正確性（バグ・ロジックエラー）
- セキュリティ（XSS, インジェクション等）
- パフォーマンス（不要な処理・レンダリングコスト）
- コード品質（可読性・保守性・命名）
- 計画との整合性（計画外の変更がないか）
- 未考慮のエッジケース

### Step 4: 判定と繰り返し

| 判定 | 次のアクション |
|------|--------------|
| **APPROVE** | タスク完了。ユーザーに報告 |
| **REJECT** | 指摘事項を Step 2 に反映し、Step 3 を再実行 |

- REJECT が続く場合は、Step 1 から計画を見直す
- 3回以上 REJECT が続いた場合はユーザーに状況報告して判断を仰ぐ

---

## 重要な禁止事項

- **計画なしに実装を開始してはならない**
- **レビューをスキップして完了報告をしてはならない**
- **Codex が REJECT した状態でユーザーに完成報告をしてはならない**

## 注意事項

- Codex ツールは `mcp__codex__codex` を使用する
- Expert プロンプトファイルは `${CLAUDE_PLUGIN_ROOT}/prompts/[expert].md` にある
- プロジェクト作業ディレクトリ: `H:/dev/guild-atorasu/正式オープンLP/open-atorasu`
